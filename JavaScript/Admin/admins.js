var queryObjectId;function onPageLoad(){document.getElementById("myTable").innerHTML="",tbl=document.getElementById("myTable");var e=Backendless.DataQueryBuilder.create();e.setSortBy(["email"]),e.setPageSize(100).setOffset(0),Backendless.Data.of("Users").find(e).then(function(e){var t,a=e.length;for(t=0;t<a;t++)addRow(tbl,e[t].name,e[t].email,e[t].userStatus,"edit","delete_forever",e[t].objectId,e[t].objectId,e[t].objectId,"update","delete",e[t].objectId,e[t].objectId)}).catch(function(e){toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")})}function addCell(e,t,a){var s=document.createElement("td");s.id=a,s.innerHTML=t,e.appendChild(s)}function addCellRight(e,t,a,s){var n=document.createElement("td");n.classList.add("right-align");var i=document.createElement("BUTTON");i.classList.add("waves-effect"),i.classList.add("waves-light"),i.classList.add("btn-small"),i.classList.add("material-icons"),i.innerHTML=t,"delete_forever"==i.innerHTML?(i.classList.add("red"),i.classList.add("lighten-2")):(i.classList.add("green"),i.classList.add("lighten-2")),i.id=a,i.name=s,n.appendChild(i),e.appendChild(n)}function addRow(e,t,a,s,n,i,o,r,d,c,l,m,u){var h=document.createElement("tr");h.id=r,addCell(h,t,o),addCell(h,a,r),addCell(h,s,d),addCellRight(h,n,c,m),addCellRight(h,i,l,u),e.appendChild(h)}function registerAdmin(){var e=document.getElementById("user_username").value.trim(),t=document.getElementById("user_email").value.trim(),a=document.getElementById("user_passw").value,s=document.getElementById("confirm_pass").value;if(!(""==e||e.length<2||e.length>20||!e.match(/^[a-z0-9]+$/i)||""==t||""==a||a!=s||a.length<8)&&a.match(/.*[A-Z].*/)&&a.match(/.*\d.*/)&&1!=/\s/.test(a)){$("#createModal").modal("close");var n=new Backendless.User;return n.email=t,n.name=e,n.password=a,Backendless.UserService.register(n).then(function(e){onPageLoad(),toastNotification("Admin created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd"),registerForm=document.querySelector("#register-form"),registerForm.reset()}).catch(function(e){toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")})}var i="";""==e&&(i+='"Username" is required!<br>'),""!=e&&e.length<2&&(i+='"Username" must be at least 2 characters!<br>'),e.length>20&&(i+='"Username" must not exceed 20 characters!<br>'),""==e||e.match(/^[a-z0-9 ]+$/i)||(i+='"Username" contains non-alphanumeric characters!<br>'),1==/\s/.test(e)&&(i+="Username cannot contain spaces!<br>"),""==t&&(i+='"Email" is required!<br>'),""==a&&(i+='"Password" is required!<br>'),a.length<8&&(i+='"Password" must be at least 8 characters!<br>'),""==a||a.match(/.*[A-Z].*/)||(i+="Password requires at least 1 uppercase character!<br>"),""==a||a.match(/.*\d.*/)||(i+="Password requires at least 1 number!<br>"),""!=a&&a!=s&&(i+="Passwords don't match!<br>"),1==/\s/.test(a)&&(i+="Password cannot contain spaces!<br>"),toastNotification(i,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")}function logoutUser(){localStorage.setItem("userStatus","logged_out"),window.location.href="../admin.html"}function updateAdmin(){M.Toast.dismissAll();var e=$("#"+queryObjectId),t=e.find("td:nth-child(1)").text(),a=e.find("td:nth-child(2)").text(),s=document.getElementById("update_user_username").value.trim(),n=document.getElementById("update_user_email").value.trim(),i=document.getElementById("update_user_passw").value,o=document.getElementById("update_confirm_pass").value,r=!1,d="";if(""==s&&(d+='"Username" is required!<br>',r=!0),""!=s&&s.length<2&&(d+='"Username" must be at least 2 characters!<br>',r=!0),s.length>20&&(d+='"Username" must not exceed 20 characters!<br>',r=!0),""==s||s.match(/^[a-z0-9 ]+$/i)||(d+='"Username" contains non-alphanumeric characters!<br>',r=!0),1==/\s/.test(s)&&(d+="Username cannot contain spaces!<br>",r=!0),""==n&&(d+='"Email" is required!<br>',r=!0),""!=i&&i.length<8&&(d+='"Password" must be at least 8 characters!<br>',r=!0),""==i||i.match(/.*[A-Z].*/)||(d+="Password requires at least 1 uppercase character!<br>",r=!0),""==i||i.match(/.*\d.*/)||(d+="Password requires at least 1 number!<br>",r=!0),i!=o&&(d+="Passwords don't match!<br>",r=!0),1==/\s/.test(i)&&(d+="Password cannot contain spaces!<br>",r=!0),1==r&&toastNotification(d,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),0==r){if($("#updateModal").modal("close"),s==t&&n==a&&""==i&&""==o)return;{const e=new Backendless.User;e.objectId=queryObjectId,t!=s&&(e.name=s),a!=n&&(e.email=n),""!=i&&(e.password=i);const o=e=>{M.Toast.dismissAll(),toastNotification(e.message+" "+e.code+" "+e.status,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")};Backendless.UserService.update(e).then(()=>onPageLoad()).then(()=>{toastNotification("Admin updated successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).then(()=>{document.getElementById("update_user_passw").value="",document.getElementById("update_confirm_pass").value=""}).catch(o)}}}function toastNotification(e,t,a,s,n,i){M.toast({html:'<div class="toast-side"></div><div class="toast-notification-con"><img class="'+t+'" src="../images/'+a+'"><div class="toast-message">'+e+'</div><img class="toast-close" src="../images/toast-close.png" height="16" width="16"></div>',displayLength:n,classes:""+s}),$(".toast-side").css({"background-color":i}),$(document).on("click",".toast-close",function(){$("#toast-container .toast").fadeOut(500,function(){$("#toast-container .toast").remove()})})}Backendless.serverURL="https://api.backendless.com",Backendless.initApp("073669A8-CCB7-2AED-FFEC-841A4CE5F400","FAFDE171-5308-49CF-9980-AA89E4F28F0C"),document.addEventListener("DOMContentLoaded",function(){onPageLoad();const e=localStorage.getItem("currentUser");document.getElementById("userEmail").innerHTML="Hi, "+e;var t=document.querySelectorAll(".fixed-action-btn");M.FloatingActionButton.init(t),t=document.querySelectorAll(".modal"),M.Modal.init(t);const a=document.getElementById("modalLogout");M.Modal.init(a,{dismissible:!1,opacity:0})}),$("#myInput").on("keyup",function(){var e=$(this).val().toLowerCase();$("#myTable tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),registerAdminBtn.addEventListener("click",e=>{M.Toast.dismissAll()}),cancelRegisterAdmin.addEventListener("click",e=>{M.Toast.dismissAll(),registerForm=document.querySelector("#register-form"),registerForm.reset()}),$(document).on("click","#update",function(){M.Toast.dismissAll();const e=document.getElementById("updateModal");M.Modal.init(e,{dismissible:!0}).open();var t=$(this).attr("name"),a=$("#"+t),s=a.find("td:nth-child(1)").text(),n=a.find("td:nth-child(2)").text();document.getElementById("update_user_username").value=s,document.getElementById("update_user_email").value=n,document.getElementById("update_user_passw").value="",document.getElementById("update_confirm_pass").value="",M.updateTextFields(),queryObjectId=t}),updateCancelBtn.addEventListener("click",e=>{M.Toast.dismissAll();var t=document.getElementById("update_user_username").value.trim(),a=document.getElementById("update_user_email").value.trim(),s=document.getElementById("update_user_passw").value,n=document.getElementById("update_confirm_pass").value,i=$("#"+queryObjectId),o=i.find("td:nth-child(1)").text(),r=i.find("td:nth-child(2)").text(),d=!0;o==t&&r==a&&""==s&&""==n&&($("#updateModal").modal("close"),updateAdminForm=document.querySelector("#updateAdmin-form"),updateAdminForm.reset(),d=!1),1==d&&$("#modalUnsaved").modal("open")}),unsavedDiscardBtn.addEventListener("click",e=>{$("#updateModal").modal("close"),updateAdminForm=document.querySelector("#updateAdmin-form"),updateAdminForm.reset()}),$(document).on("click","#delete",function(){const e=document.getElementById("deleteModal");M.Modal.init(e,{dismissible:!0}).open();var t=$(this).attr("name"),a=$("#"+t),s=a.find("td:first").text(),n=a.find("td:nth-child(2)").text();document.getElementById("modalDeleteAdminMessage").innerHTML='<span style="font-size:120%">Do you want to delete the selected Admin?</span><br><br><b>'+s+'</b><span style="margin-left:10%">'+n+"</span>",queryObjectId=t}),modalDeleteAdminConfirm.addEventListener("click",e=>Backendless.Data.of("Users").remove({objectId:queryObjectId}).then(function(e){onPageLoad(),toastNotification("Admin deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).catch(function(e){toastNotification(e,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")})),exportConfirmBtn.addEventListener("click",e=>{var t=document.getElementById("establishmentExportChkBox").checked,a=document.getElementById("specialExportChkBox").checked,s=document.getElementById("cuisineExportChkBox").checked,n=document.getElementById("adminExportChkBox").checked;if(0==t&&0==a&&0==s&&0==n)M.Toast.dismissAll(),toastNotification("Please select a table","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{if(1==t){const e=100,t=async()=>{let t=0,a=[];const s=Backendless.DataQueryBuilder.create();s.setRelated(["establishmentSpecials"]),s.setSortBy(["Country","Name"]),s.setPageSize(e);do{const e=await Backendless.Data.of("Establishment").find(s);t=e.length,a=a.concat(e),s.prepareNextPage()}while(t>=e);return a},a=e=>{var t=[],a=[];a.push("Country","Location","Address","Suburb","Postcode","Establishment_ Type","Cuisine_Type","Name","Image","Google_Business_Link","Website_Link","objectId"),t.push(a),e.forEach(e=>{tempEstablishment=[],tempEstablishment.push(e.Country);var a="POINT("+e.Location.x+" "+e.Location.y+")";tempEstablishment.push(a),tempEstablishment.push(e.Address),tempEstablishment.push(e.Suburb),tempEstablishment.push(e.Postcode),tempEstablishment.push(e.Establishment_Type),tempEstablishment.push(e.Cuisine_Type),tempEstablishment.push(e.Name),tempEstablishment.push(e.Image),tempEstablishment.push(e.Google_Business_Link),tempEstablishment.push(e.Website_Link),tempEstablishment.push(e.objectId),t.push(tempEstablishment)});let s="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var n=encodeURI(s),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download","Establishment.csv"),document.body.appendChild(i),i.click()},s=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(a).catch(s)}if(1==a){const e=100,t=async()=>{let t=0,a=[];const s=Backendless.DataQueryBuilder.create();s.setRelated(["establishmentSpecials"]),s.setSortBy(["Country","Name"]),s.setPageSize(e);do{const e=await Backendless.Data.of("Establishment").find(s);t=e.length,a=a.concat(e),s.prepareNextPage()}while(t>=e);return a},a=e=>{var t=[],a=[];a.push("Type_Of_Special","Days_Of_Week","Start_Time","End_Time","Category","Description","objectId"),t.push(a),e.forEach(e=>{for(var a=0,s=e.establishmentSpecials.length;a<s;a++)tempSpecial=[],tempSpecial.push(e.establishmentSpecials[a].Type_Of_Special),tempSpecial.push(`"${e.establishmentSpecials[a].Days_Of_Week}"`),tempSpecial.push(e.establishmentSpecials[a].Start_Time),tempSpecial.push(e.establishmentSpecials[a].End_Time),tempSpecial.push(e.establishmentSpecials[a].Category),tempSpecial.push(e.establishmentSpecials[a].Description),tempSpecial.push(e.establishmentSpecials[a].objectId),t.push(tempSpecial)});let s="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var n=encodeURI(s),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download","Special.csv"),document.body.appendChild(i),i.click()},s=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(a).catch(s)}if(1==s){const e=100,t=async()=>{let t=0,a=[];const s=Backendless.DataQueryBuilder.create();s.setSortBy(["Name"]),s.setPageSize(e);do{const e=await Backendless.Data.of("Cuisine").find(s);t=e.length,a=a.concat(e),s.prepareNextPage()}while(t>=e);return a},a=e=>{var t=[],a=[];a.push("Name"),t.push(a),e.forEach(e=>{tempCuisine=[],tempCuisine.push(e.Name),t.push(tempCuisine)});let s="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var n=encodeURI(s),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download","Cuisine.csv"),document.body.appendChild(i),i.click()},s=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(a).catch(s)}if(1==n){const e=100,t=async()=>{let t=0,a=[];const s=Backendless.DataQueryBuilder.create();s.setSortBy(["name"]),s.setPageSize(e);do{const e=await Backendless.Data.of("Users").find(s);t=e.length,a=a.concat(e),s.prepareNextPage()}while(t>=e);return a},a=e=>{var t=[],a=[];a.push("Username"),a.push("Email"),t.push(a),e.forEach(e=>{tempAdmin=[],tempAdmin.push(e.name),tempAdmin.push(e.email),t.push(tempAdmin)});let s="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var n=encodeURI(s),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download","Admin.csv"),document.body.appendChild(i),i.click()},s=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(a).catch(s)}}});