Backendless.serverURL="https://api.backendless.com",Backendless.initApp("073669A8-CCB7-2AED-FFEC-841A4CE5F400","FAFDE171-5308-49CF-9980-AA89E4F28F0C");var cellID,masterEstablishments=[],Australia=!0;function logoutUser(){localStorage.setItem("userStatus","logged_out"),window.location.href="../admin.html"}function onPageLoadTable(e){$("#myTable tr").remove();var t=document.getElementById("myTable");Promise.resolve().then(async()=>{let e=0;masterEstablishments=[];const n=Backendless.DataQueryBuilder.create();n.setRelated(["establishmentSpecials"]),1==Australia?n.setWhereClause("Country = 'Australia'"):n.setWhereClause("Country = 'New Zealand'"),n.setSortBy(["Name"]),n.setPageSize(100);do{const s=await Backendless.Data.of("Establishment").find(n);e=s.length,masterEstablishments=masterEstablishments.concat(s);for(var a=0;a<s.length;a++)addRow(t,s[a].Name,s[a].Address,s[a].Suburb,s[a].Postcode,s[a].objectId,s[a].objectId);n.prepareNextPage()}while(e>=100);return addRowHandlers(),masterEstablishments}).then(()=>{displaySpecials()}).then(()=>{$("#tbl").scrollTop(e)}).then(()=>{var e=document.getElementById("myInput").value;e=e.toLowerCase(),$("#myTable tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}).catch(e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)})}function addCell(e,t,n){var a=document.createElement("td");a.id=n,a.innerHTML=t,e.appendChild(a)}function addCellHidden(e,t,n){var a=document.createElement("td");a.id=n,a.innerHTML=t,a.classList.add("cell-hidden"),e.appendChild(a)}function addRow(e,t,n,a,s,d,i){var l=document.createElement("tr");addCell(l,t,d),addCell(l,n,i),addCellHidden(l,a),addCellHidden(l,s),e.appendChild(l)}function addRowHandlers(){var e=document.getElementById("tbl"),t=e.getElementsByTagName("tr");for(i=0;i<t.length;i++){var n=e.rows[i];n.onclick=function(e){return function(){var t=e.getElementsByTagName("td")[0].id;cellID=t,displaySpecials()}}(n)}}function checkBoxAddToEstablishmentFunc(){if(""==document.getElementById("establishmentId").value)M.Toast.dismissAll(),toastNotification("No establishment selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),document.getElementById("chkBoxAddToEstablishment").checked=!1;else if(1==document.getElementById("chkBoxAddToEstablishment").checked){document.getElementById("or").style.display="none",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Adding special to "+document.getElementById("name").value+"</h5>",document.getElementById("add_name").value=document.getElementById("name").value,document.getElementById("add_name").disabled=!0,document.getElementById("add_address").value=document.getElementById("address").value,document.getElementById("add_address").disabled=!0,document.getElementById("add_suburb").value=document.getElementById("suburb").value,document.getElementById("add_suburb").disabled=!0,document.getElementById("add_postcode").value=document.getElementById("postcode").value,document.getElementById("add_postcode").disabled=!0,"Establishments - Australia"==document.getElementById("headingLstBoxEstablishments").innerHTML?(document.getElementById("add_country").value="Australia",document.getElementById("add_country").disabled=!0):(document.getElementById("add_country").value="New Zealand",document.getElementById("add_country").disabled=!0),document.getElementById("add_establishment_type").value=document.getElementById("establishmentType").value,document.getElementById("add_establishment_type").disabled=!0;var e=document.getElementById("cusineType").value.split(", ");$("#add_cusine_type").val(e),document.getElementById("add_cusine_type").disabled=!0,document.getElementById("add_google_link").value=document.getElementById("googleLink").value,document.getElementById("add_google_link").disabled=!0,document.getElementById("add_website_link").value=document.getElementById("websiteLink").value,document.getElementById("add_website_link").disabled=!0,document.getElementById("files").disabled=!0,document.getElementById("filesText").value=document.getElementById("image-file-name").innerHTML,document.getElementById("filesText").disabled=!0,document.getElementById("chkBoxAddDefaultImg").checked=!1,document.getElementById("chkBoxAddDefaultImg").disabled=!0,document.getElementById("skipSpecial").style.display="none",$("select").formSelect(),M.updateTextFields()}else{document.getElementById("or").style.display="block",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",enableEstablishmentDetails(),addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset();var t=document.getElementById("name").value+" | "+document.getElementById("address").value;" | "==t&&(t="Please select an existing establishment."),document.getElementById("addToExistingEstablishment").value=t,document.getElementById("addToExistingEstablishment").name=document.getElementById("establishmentId").value,document.getElementById("skipSpecial").style.display="block",$("select").formSelect(),M.updateTextFields()}}function checkBoxAddDefaultImg(){1==document.getElementById("chkBoxAddDefaultImg").checked?(document.getElementById("files").disabled=!0,document.getElementById("filesText").disabled=!0):(document.getElementById("files").disabled=!1,document.getElementById("filesText").disabled=!1)}function checkBoxUpdateDefaultImg(){1==document.getElementById("chkBoxUpdateDefaultImg").checked?(document.getElementById("updateFiles").disabled=!0,document.getElementById("updateFilesText").disabled=!0):(document.getElementById("updateFiles").disabled=!1,document.getElementById("updateFilesText").disabled=!1)}function removeOptions(e){var t;for(t=e.options.length-1;t>=0;t--)e.remove(t)}function displaySpecials(){document.getElementById("formSpecialDetails").style.display="none",document.getElementById("formEstablishmentDetails").style.display="block";var e=document.getElementById("establishmentId"),t=document.getElementById("name"),n=document.getElementById("address"),a=document.getElementById("suburb"),s=document.getElementById("postcode"),d=document.getElementById("country"),i=document.getElementById("establishmentType"),l=document.getElementById("cusineType"),o=document.getElementById("googleLink"),m=document.getElementById("websiteLink"),c=document.getElementById("image"),r=document.getElementById("image-file-name");document.getElementById("formHeading").innerHTML="Establishment details";for(var u=cellID,g=0;g<masterEstablishments.length;g++)if(masterEstablishments[g].objectId==u){console.log(masterEstablishments[g].Visible),1==masterEstablishments[g].Visible?document.getElementById("displaySpecialsForm").style.backgroundColor="white":document.getElementById("displaySpecialsForm").style.backgroundColor="#d9d9d9",e.value=masterEstablishments[g].objectId,t.value=masterEstablishments[g].Name,n.value=masterEstablishments[g].Address,a.value=masterEstablishments[g].Suburb,s.value=masterEstablishments[g].Postcode,d.value=masterEstablishments[g].Country,i.value=masterEstablishments[g].Establishment_Type,l.value=masterEstablishments[g].Cuisine_Type,o.value=masterEstablishments[g].Google_Business_Link,m.value=masterEstablishments[g].Website_Link,c.src=masterEstablishments[g].Image,r.innerHTML=/[^\/]*$/.exec(masterEstablishments[g].Image)[0];break}var h,p=document.getElementById("specialListBox");removeOptions(p);for(g=0;g<masterEstablishments.length;g++)if(u==masterEstablishments[g].objectId){h=g;for(var y=0;y<masterEstablishments[h].establishmentSpecials.length;y++){var b=y+1+". "+masterEstablishments[h].establishmentSpecials[y].Category.replace("Special","")+" - "+masterEstablishments[h].establishmentSpecials[y].Description;b.length>45&&(b=b.substring(0,45)+".."),p.options[y]=new Option(b,masterEstablishments[h].objectId)}break}M.updateTextFields()}function getSpecial(){try{document.getElementById("formEstablishmentDetails").style.display="none",document.getElementById("formSpecialDetails").style.display="block",document.getElementById("formHeading").innerHTML="Special details";for(var e=document.getElementById("specialListBox"),t=e.options[e.selectedIndex].value,n=e.options[e.selectedIndex].index,a=0;a<masterEstablishments.length;a++)if(t==masterEstablishments[a].objectId){1==masterEstablishments[a].establishmentSpecials[n].Visible?document.getElementById("displaySpecialsForm").style.backgroundColor="white":document.getElementById("displaySpecialsForm").style.backgroundColor="#d9d9d9",document.getElementById("establishmentIdSpecial").value=masterEstablishments[a].objectId,document.getElementById("specialId").value=masterEstablishments[a].establishmentSpecials[n].objectId;var s=masterEstablishments[a].establishmentSpecials[n].Days_Of_Week;if(document.getElementById("daysOfWeek").value=s,document.getElementById("startTime").value=tConvert(masterEstablishments[a].establishmentSpecials[n].Start_Time),document.getElementById("endTime").value=tConvert(masterEstablishments[a].establishmentSpecials[n].End_Time),document.getElementById("category").value=masterEstablishments[a].establishmentSpecials[n].Category,document.getElementById("typeOfSpecial").value=masterEstablishments[a].establishmentSpecials[n].Type_Of_Special,document.getElementById("descriptionFullText").value=masterEstablishments[a].establishmentSpecials[n].Description,masterEstablishments[a].establishmentSpecials[n].Description.length>125){var d=masterEstablishments[a].establishmentSpecials[n].Description;document.getElementById("description").value=d.substring(0,121)+" ...",$("#tooltip").attr("data-tooltip",masterEstablishments[a].establishmentSpecials[n].Description),$(".material-tooltip").css({display:"block"})}else if(masterEstablishments[a].establishmentSpecials[n].Description.length<=125){document.getElementById("description").value=masterEstablishments[a].establishmentSpecials[n].Description,$("#tooltip").attr("data-tooltip","Less than 125"),$(".material-tooltip").css({display:"none"})}break}M.textareaAutoResize($("#description")),M.updateTextFields()}catch(e){console.log(e),document.getElementById("specialId").value="",document.getElementById("daysOfWeek").value="",document.getElementById("startTime").value="",document.getElementById("endTime").value="",document.getElementById("category").value="",document.getElementById("typeOfSpecial").value="",document.getElementById("description").value="",$(".material-tooltip").css({display:"none"})}}function displayAus(){"Establishments - Australia"!=document.getElementById("headingLstBoxEstablishments").innerHTML&&($("#myInput").val(""),Australia=!0,onPageLoadTable(),$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("headingLstBoxEstablishments").innerHTML="Establishments - Australia")}function displayNZ(){"Establishments - New Zealand"!=document.getElementById("headingLstBoxEstablishments").innerHTML&&($("#myInput").val(""),Australia=!1,onPageLoadTable(),$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("headingLstBoxEstablishments").innerHTML="Establishments - New Zealand")}function toastNotification(e,t,n,a,s,d,i){M.toast({html:'<div class="toast-side"></div><div class="toast-notification-con"><img class="'+t+'" src="../images/'+n+'"><div class="toast-message">'+e+'</div><img class="toast-close" src="../images/toast-close.png" height="16" width="16"></div>',displayLength:s,classes:""+a,outDuration:i}),$(".toast-side").css({"background-color":d}),$(document).on("click",".toast-close",function(){$("#toast-container .toast").fadeOut(500,function(){$("#toast-container .toast").remove()})})}function enableEstablishmentDetails(){document.getElementById("add_name").disabled=!1,document.getElementById("add_address").disabled=!1,document.getElementById("add_suburb").disabled=!1,document.getElementById("add_postcode").disabled=!1,document.getElementById("add_country").disabled=!1,document.getElementById("add_establishment_type").disabled=!1,document.getElementById("add_cusine_type").disabled=!1,document.getElementById("add_google_link").disabled=!1,document.getElementById("add_website_link").disabled=!1,document.getElementById("files").disabled=!1,document.getElementById("filesText").disabled=!1,document.getElementById("chkBoxAddDefaultImg").disabled=!1,$("select").formSelect()}function enableCreateCustomImage(){document.getElementById("files").disabled=!1,document.getElementById("filesText").disabled=!1}function enableUpdateCustomImage(){document.getElementById("updateFiles").disabled=!1,document.getElementById("updateFilesText").disabled=!1}function tConvert(e){return(e=e.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[e]).length>1&&((e=e.slice(1))[5]=+e[0]<12?" AM":" PM",e[0]=+e[0]%12||12),e.join("")}function convertTo24Hour2(e){time=document.getElementById(e).value;var t=Number(time.match(/^(\d+)/)[1]),n=Number(time.match(/:(\d+)/)[1]),a=time.match(/\s(.*)$/)[1];"PM"==a&&t<12&&(t+=12),"AM"==a&&12==t&&(t-=12);var s=t.toString(),d=n.toString();return t<10&&(s="0"+s),n<10&&(d="0"+d),s+":"+d}function endAnimations(){document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"}document.addEventListener("DOMContentLoaded",function(){onPageLoadTable();const e=localStorage.getItem("currentUser");document.getElementById("userEmail").innerHTML="Hi, "+e,$(".tabs").tabs(),$("select").formSelect(),$(".modal").modal(),$("input#input_text, textarea#add_description").characterCounter(),$("input#input_text, textarea#update_description").characterCounter(),M.textareaAutoResize($("#description")),$(".modal-add").modal({startingTop:"4%"}),$(".tooltipped").tooltip(),$(".sidenav").sidenav()}),$("#myInput").on("keyup",function(){var e=$(this).val().toLowerCase();$("#myTable tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),$(function(){$("#tbl").on("click","tbody tr",function(e){$(this).addClass("selected-row").siblings().removeClass("selected-row")})}),addBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll(),document.getElementById("addConfirmBtn").classList.remove("modal-close"),document.getElementById("addSkipSpecialBtn").classList.remove("modal-close");var t=document.getElementById("name").value+" | "+document.getElementById("address").value;if(" | "==t&&(t="Please select an existing establishment."),document.getElementById("addToExistingEstablishment").value=t,document.getElementById("addToExistingEstablishment").name=document.getElementById("establishmentId").value,0==document.getElementById("chkBoxAddToEstablishment").checked){var n=Backendless.DataQueryBuilder.create();return n.setSortBy(["Name"]),n.setPageSize(100).setOffset(0),Backendless.Data.of("Cuisine").find(n).then(function(e){var t=document.getElementById("add_cusine_type");$("#add_cusine_type").empty();var n=1,a=0,s=e.length;for(a=0;a<s;a++)t.options[0]=new Option("Choose your cuisine type",""),t.options[0].disabled=!0,t.options[n]=new Option(e[a].Name,e[a].Name),n++;$("select").formSelect()}).catch(function(e){})}}),addConfirmBtn.addEventListener("click",e=>{if(M.Toast.dismissAll(),0==document.getElementById("chkBoxAddToEstablishment").checked){console.log("Create new establishment and special concurrently");var t=document.getElementById("add_name").value.trim(),n=document.getElementById("add_postcode").value.trim(),a=document.getElementById("add_country").value,s=document.getElementById("add_establishment_type").value,d=$("#add_cusine_type").val().join(", "),i=document.getElementById("filesText").value.trim(),l=document.getElementById("add_google_link").value.trim(),o=document.getElementById("add_website_link").value.trim(),m=document.getElementById("chkBoxAddDefaultImg").checked,c=document.getElementById("add_address").value.trim(),r=document.getElementById("add_suburb").value.trim(),u=$("#add_days_of_the_week").val().join(", "),g=document.getElementById("add_start_time").value,h=document.getElementById("add_end_time").value,p=document.getElementById("add_category").value,y=document.getElementById("add_type_of_special").value,b=document.getElementById("add_description").value.trim();if(""==t||t.length>50||""==c||c.length>100||""!=c&&!c.match(/^[a-zA-Z0-9\/\-\&  ]+$/)||""==r||r.length>25||""!=r&&!r.match(/^[A-Za-z ]+$/)||""==n||4!=n.length||""!=n&&!n.match(/^[0-9]+$/)||""==a||""==d||l.length>100||o.length>100||""==i&&0==m||""==g||""==h||g>h||g==h||""==p||""==y||""==b||b.length>500){var E="";""==t&&(E+='"Name" is required!<br>'),t.length>50&&(E+='"Name" must not exceed 50 characters!<br>'),""==c&&(E+='"Address" is required!<br>'),c.length>100&&(E+='"Address" must not exceed 100 characters!<br>'),""==c||c.match(/^[a-zA-Z0-9\/\-\&  ]+$/)||(E+='"Address" contains non-alphanumerical characters! Exception ("/", "-", "&").<br>'),""==r&&(E+='"Suburb" is required!<br>'),r.length>25&&(E+='"Suburb" must not exceed 25 characters!<br>'),""==r||r.match(/^[A-Za-z ]+$/)||(E+='"Suburb" contains non-alphabetic characters!<br>'),""==n&&(E+='"Postcode" is required!<br>'),4!=n.length&&(E+='"Postcode" must be 4 numbers!<br>'),""==n||n.match(/^[0-9]+$/)||(E+='"Postcode" contains non-numerical characters!<br>'),""==a&&(E+='"Country" is required!<br>'),""==d&&(E+='"Cuisine Type" is required!<br>'),l.length>100&&(E+='"Google Buisness Link" must not exceed 100 characters!<br>'),o.length>100&&(E+='"Website Link" must not exceed 100 characters!<br>'),""==i&&0==m&&(E+='"Image" is required!<br>'),""==g&&(E+='"Start time" is required!<br>'),""==h&&(E+='"End time" is required!<br>'),g>h&&(E+='"Start time" cannot be later than End time!<br>'),g==h&&(E+='"Start time" cannot be the same as "End time"!<br>'),""==p&&(E+='"Category" is required!<br>'),""==y&&(E+='"Type of special" is required!<br>'),""==b&&(E+='"Description" is required!<br>'),b.length>500&&(E+='"Description" must not exceed 500 characters!<br>'),toastNotification(E,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),e.preventDefault()}else{var I;document.getElementById("addConfirmBtn").classList.add("modal-close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";var B,f,v=c+" "+r,k=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:v,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return B=e.data.results[0].geometry.location.lat,f=e.data.results[0].geometry.location.lng,k.push(B),k.push(f),k}).then(()=>{if(1!=m){if(0==document.getElementById("onOffSwitch").checked)return file=document.getElementById("files").files[0],Backendless.Files.upload(file,"images").then(function(e){I=e.fileURL}).catch(function(e){"Error: Unable to upload the file: file already exists"==e&&(toastNotification("A file with the name "+document.getElementById("files").files[0].name+" already exists.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations())});console.log("On"),console.log("1. else Produce cropped image");var e=document.getElementById("filesText").value;return new Promise(function(t,n){cropper.getCroppedCanvas({width:545,height:120,minWidth:545,minHeight:120,maxWidth:4096,maxHeight:4096,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}).toBlob(function(n){return console.log("2. convert to blob"),Backendless.Files.saveFile("images",e,n,!0).then(function(e){I=e,quote=I,t(quote),console.log("3. file has been saved - "+e)})},"image/jpeg")})}I="https://backendlessappcontent.com/073669A8-CCB7-2AED-FFEC-841A4CE5F400/CCB6BFB7-82E5-4240-A911-5E169AEA70F2/files/images/default.jpg"}).then(()=>{Promise.all([(()=>{var e={Google_Business_Link:l,Website_Link:o,Image:I,Location:(new Backendless.Data.Point).setLatitude(k[0]).setLongitude(k[1]),Name:t,Address:c,Suburb:r,Postcode:n,Country:a,Cuisine_Type:d,Establishment_Type:s};return Backendless.Data.of("Establishment").save(e).then(e=>e.objectId)})(),(()=>{""==u&&(u="Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday");var e={Days_Of_Week:u,Start_Time:g,End_Time:h,Category:p,Type_Of_Special:y,Description:b};return Backendless.Data.of("Special").save(e).then(e=>e.objectId)})()]).then(([e,t])=>{var n={objectId:e},a=[{objectId:t}];return cellID=e,Backendless.Data.of("Establishment").addRelation(n,"establishmentSpecials",a).then(function(e){})}).then(()=>{onPageLoadTable()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment and Special has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{M.updateTextFields()}).then(()=>{hideCroppedImg("create")}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e)),"Error: Field 'Image' doesn't have a default value"==e?endAnimations():(toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations())})})}}else if(1==document.getElementById("chkBoxAddToEstablishment").checked){u=$("#add_days_of_the_week").val().join(", "),g=document.getElementById("add_start_time").value,h=document.getElementById("add_end_time").value,p=document.getElementById("add_category").value,y=document.getElementById("add_type_of_special").value,b=document.getElementById("add_description").value.trim();if(console.log(g),console.log(h),""==g||""==h||g>h||g==h||""==p||""==y||""==b||b.length>500){E="";""==g&&(E+='"Start time" is required!<br>'),""==h&&(E+='"End time" is required!<br>'),g>h&&(E+='"Start time" cannot be later than End time!<br>'),g==h&&(E+='"Start time" cannot be the same as "End time"!<br>'),""==p&&(E+='"Category" is required!<br>'),""==y&&(E+='"Type of special" is required!<br>'),""==b&&(E+='"Description" is required!<br>'),b.length>500&&(E+='"Description" must not exceed 500 characters!<br>'),toastNotification(E,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}else{document.getElementById("addConfirmBtn").classList.add("modal-close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";const e=()=>establishmentObjectId=document.getElementById("addToExistingEstablishment").name,t=()=>{""==u&&(u="Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday");var e={Days_Of_Week:u,Start_Time:g,End_Time:h,Category:p,Type_Of_Special:y,Description:b};return Backendless.Data.of("Special").save(e).then(e=>e.objectId)};Promise.all([e(),t()]).then(([e,t])=>{var n={objectId:e},a=[{objectId:t}];return cellID=e,Backendless.Data.of("Establishment").addRelation(n,"establishmentSpecials",a).then(function(e){}).catch(function(e){})}).then(()=>{onPageLoadTable()}).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{enableEstablishmentDetails()}).then(()=>{document.getElementById("or").style.display="block",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",document.getElementById("skipSpecial").style.display="block"}).then(()=>{M.updateTextFields()}).catch(e=>{console.error(e)})}}}),addCancelBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll();var t=document.getElementById("add_name").value.trim(),n=document.getElementById("add_country").value,a=document.getElementById("add_postcode").value.trim(),s=document.getElementById("add_establishment_type").value,d=document.getElementById("add_cusine_type").value,i=document.getElementById("add_google_link").value,l=document.getElementById("add_website_link").value,o=document.getElementById("filesText").value.trim(),m=document.getElementById("chkBoxAddDefaultImg").checked,c=document.getElementById("add_address").value.trim(),r=document.getElementById("add_suburb").value.trim(),u=$("#add_days_of_the_week").val().join(", "),g=document.getElementById("add_start_time").value,h=document.getElementById("add_end_time").value,p=document.getElementById("add_category").value,y=document.getElementById("add_type_of_special").value,b=document.getElementById("add_description").value.trim(),E=!0;(0!=document.getElementById("chkBoxAddToEstablishment").checked||""!=t||""!=c||""!=r||""!=a||""!=n||"N/A"!=s||""!=d||""!=o||0!=m||""!=i||""!=l)&&1!=document.getElementById("chkBoxAddToEstablishment").checked||""!=u||""!=g&&"18:00"!=g||""!=h&&"21:00"!=h||"Dinner Special"!=p||""!=y||""!=b||($("#modal1").modal("close"),enableEstablishmentDetails(),addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset(),document.getElementById("imgCropperContainer").style.display="none",document.getElementById("imageCropperError").style.display="none",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",E=!1),1==E&&$("#modalAddCancelConfirm").modal("open")}),addCancelConfirmDiscardBtn.addEventListener("click",e=>{$("#modal1").modal("close"),addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset(),hideCroppedImg("create"),enableEstablishmentDetails(),document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",$("select").formSelect(),$("input#input_text, textarea#add_description").characterCounter()}),addSkipSpecialBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll();var t=document.getElementById("add_address").value.trim(),n=document.getElementById("add_suburb").value.trim(),a=document.getElementById("add_name").value.trim(),s=document.getElementById("add_postcode").value.trim(),d=document.getElementById("add_country").value,i=document.getElementById("add_establishment_type").value,l=$("#add_cusine_type").val().join(", "),o=document.getElementById("filesText").value,m=document.getElementById("add_google_link").value.trim(),c=document.getElementById("add_website_link").value.trim(),r=document.getElementById("chkBoxAddDefaultImg").checked;if(""==a||a.length>50||""==t.trim()||t.length>100||""!=t&&!t.match(/^[a-zA-Z0-9\/\-\& ]+$/)||""==n||n.length>25||""!=n&&!n.match(/^[A-Za-z ]+$/)||""==s||4!=s.length||""!=s&&!s.match(/^[0-9]+$/)||""==d||""==l||m.length>100||c.length>100||""==o&&0==r){var u="";""==a&&(u+='"Name" is required!<br>'),a.length>50&&(u+='"Name" must not exceed 50 characters!<br>'),""==t&&(u+='"Address" is required!<br>'),t.length>100&&(u+='"Address" must not exceed 100 characters!<br>'),""==t||t.match(/^[a-zA-Z0-9\/\-\& ]+$/)||(u+='"Address" contains non-alphanumerical characters! Exception ("/", "-", "&").<br>'),""==n&&(u+='"Suburb" is required!<br>'),n.length>25&&(u+='"Suburb" must not exceed 25 characters!<br>'),""==n||n.match(/^[A-Za-z ]+$/)||(u+='"Suburb" contains non-alphabetic characters!<br>'),""==s&&(u+='"Postcode" is required!<br>'),4!=s.length&&(u+='"Postcode" must be 4 numbers!<br>'),""==s||s.match(/^[0-9]+$/)||(u+='"Postcode" contains non-numerical characters!<br>'),""==d&&(u+='"Country" is required!<br>'),""==l&&(u+='"Cuisine Type" is required!<br>'),m.length>100&&(u+='"Google Buisness Link" must not exceed 100 characters!<br>'),c.length>100&&(u+='"Website Link" must not exceed 100 characters!<br>'),""==o&&0==r&&(u+='"Image" is required!<br>'),toastNotification(u,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}else{var g;document.getElementById("addSkipSpecialBtn").classList.add("modal-close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";var h,p,y=t+" "+n,b=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:y,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return h=e.data.results[0].geometry.location.lat,p=e.data.results[0].geometry.location.lng,b.push(h),b.push(p),b}).then(()=>{if(1!=r){if(0==document.getElementById("onOffSwitch").checked)return console.log("Off"),file=document.getElementById("files").files[0],Backendless.Files.upload(file,"images").then(function(e){g=e.fileURL});console.log("On"),console.log("1. else Produce cropped image");var e=document.getElementById("filesText").value;return new Promise(function(t,n){cropper.getCroppedCanvas({width:545,height:120,minWidth:545,minHeight:120,maxWidth:4096,maxHeight:4096,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}).toBlob(function(n){return console.log("2. convert to blob"),Backendless.Files.saveFile("images",e,n,!0).then(function(e){g=e,quote=g,t(quote),console.log("3. file has been saved - "+e)})},"image/jpeg")})}g="https://backendlessappcontent.com/073669A8-CCB7-2AED-FFEC-841A4CE5F400/CCB6BFB7-82E5-4240-A911-5E169AEA70F2/files/images/default.jpg"}).then(()=>{console.log("4. Create establishment"),console.log(g);var e={Google_Business_Link:m,Website_Link:c,Image:g,Location:(new Backendless.Data.Point).setLatitude(b[0]).setLongitude(b[1]),Name:a,Address:t,Suburb:n,Postcode:s,Country:d,Cuisine_Type:l,Establishment_Type:i};return Backendless.Data.of("Establishment").save(e).then(function(e){cellID=e.objectId,console.log("5. Done")})}).then(()=>{onPageLoadTable()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{enableCreateCustomImage()}).then(()=>{M.updateTextFields()}).then(()=>{hideCroppedImg("create")}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e)),"Error: Unable to upload the file: file already exists"==e?(toastNotification("A file with the name "+document.getElementById("files").files[0].name+" already exists.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()):(toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()),console.error(e)})}}),updateBtn.addEventListener("click",e=>{if(e.preventDefault(),M.Toast.dismissAll(),updateForm=document.querySelector("#updatespecial-form"),updateForm.reset(),""==document.getElementById("establishmentId").value)toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{if("Establishment details"==document.getElementById("formHeading").innerHTML){$("#updateModal").modal("open"),document.getElementById("formUpdateSpecialDetails").style.display="none",document.getElementById("formUpdateEstablishmentDetails").style.display="block",document.getElementById("updateHeading").innerHTML="Update Establishment",document.getElementById("update_establishmentId").value=document.getElementById("establishmentId").value,document.getElementById("update_name").value=document.getElementById("name").value,document.getElementById("update_address").value=document.getElementById("address").value,document.getElementById("update_suburb").value=document.getElementById("suburb").value,document.getElementById("update_postcode").value=document.getElementById("postcode").value,document.getElementById("update_country").value=document.getElementById("country").value,document.getElementById("update_google_link").value=document.getElementById("googleLink").value,document.getElementById("update_website_link").value=document.getElementById("websiteLink").value,document.getElementById("update_establishment_type").value=document.getElementById("establishmentType").value,document.getElementById("update-image-file-name").innerHTML=document.getElementById("image-file-name").innerHTML,document.getElementById("updateimage").src=document.getElementById("image").src,$("select").formSelect(),M.updateTextFields();var t=Backendless.DataQueryBuilder.create();return t.setSortBy(["Name"]),t.setPageSize(100).setOffset(0),Backendless.Data.of("Cuisine").find(t).then(function(e){var t=document.getElementById("update_cusine_type");$("#update_cusine_type").empty();var n=1,a=0,s=e.length;for(a=0;a<s;a++)t.options[0]=new Option("Choose your cuisine type",""),t.options[0].disabled=!0,t.options[n]=new Option(e[a].Name,e[a].Name),n++}).then(()=>{var e=document.getElementById("cusineType").value.split(", ");$("#update_cusine_type").val(e),$("select").formSelect()}).catch(function(e){})}if("Special details"==document.getElementById("formHeading").innerHTML)if(""==document.getElementById("specialId").value)toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{$("#updateModal").modal("open"),M.textareaAutoResize($("#update_description")),document.getElementById("updateHeading").innerHTML="Update Special",document.getElementById("formUpdateEstablishmentDetails").style.display="none",document.getElementById("formUpdateSpecialDetails").style.display="block";var n=document.getElementById("daysOfWeek").value.split(", ");$("#update_days_of_the_week").val(n),document.getElementById("update_start_time").value=convertTo24Hour2("startTime"),document.getElementById("update_end_time").value=convertTo24Hour2("endTime"),document.getElementById("update_category").value=document.getElementById("category").value,document.getElementById("update_type_of_special").value=document.getElementById("typeOfSpecial").value,document.getElementById("update_description").value=document.getElementById("descriptionFullText").value,M.textareaAutoResize($("#update_description"))}}$("select").formSelect(),M.updateTextFields()}),updateConfirmBtn.addEventListener("click",e=>{if(e.preventDefault(),M.Toast.dismissAll(),"Establishment details"==document.getElementById("formHeading").innerHTML){var t=document.getElementById("establishmentId").value.trim(),n=document.getElementById("update_name").value.trim(),a=document.getElementById("update_address").value.trim(),s=document.getElementById("update_suburb").value.trim(),d=document.getElementById("update_postcode").value.trim(),i=document.getElementById("update_country").value,l=document.getElementById("update_establishment_type").value,o=$("#update_cusine_type").val().join(", "),m=document.getElementById("update_google_link").value.trim(),c=document.getElementById("update_website_link").value.trim(),r=document.getElementById("updateFilesText").value,u=document.getElementById("chkBoxUpdateDefaultImg").checked;if(""==n||n.length>50||""==a||a.length>100||""!=a&&!a.match(/^[a-zA-Z0-9\/\-\& ]+$/)||""==s||s.length>25||""!=s&&!s.match(/^[A-Za-z ]+$/)||""==d||4!=d.length||""!=d&&!d.match(/^[0-9]+$/)||""==i||""==o||m.length>100||c.length>100||"default.jpg"==r&&0==u){var g="";""==n&&(g+='"Name" is required!<br>'),n.length>50&&(g+='"Name" must not exceed 50 characters!<br>'),""==a&&(g+='"Address" is required!<br>'),a.length>100&&(g+='"Address" must not exceed 100 characters!<br>'),""==a||a.match(/^[a-zA-Z0-9\/\-\& ]+$/)||(g+='"Address" contains non-alphanumerical characters! Exception ("/", "-", "&").<br>'),""==s&&(g+='"Suburb" is required!<br>'),s.length>25&&(g+='"Suburb" must not exceed 25 characters!<br>'),""==s||s.match(/^[A-Za-z ]+$/)||(g+='"Suburb" contains non-alphabetic characters!<br>'),""==d&&(g+='"Postcode" is required!<br>'),d.length>4&&(g+='"Postcode" must not exceed 4 numbers!<br>'),d.length<4&&(g+='"Postcode" must be 4 numbers!<br>'),""==d||d.match(/^[0-9]+$/)||(g+='"Postcode" contains non-numerical characters!<br>'),""==i&&(g+='"Country" is required!<br>'),""==o&&(g+='"Cuisine Type" is required!<br>'),m.length>100&&(g+='"Google Buisness Link" must not exceed 100 characters!<br>'),c.length>100&&(g+='"Website Link" must not exceed 100 characters!<br>'),"default.jpg"==r&&0==u&&(g+='"default.jpg" is a reserved filename!<br>'),toastNotification(g,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),e.preventDefault()}else if($("#updateModal").modal("close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block",document.getElementById("address").value==a&&document.getElementById("suburb").value==s||""==document.getElementById("updateFiles").value&&1!=u)if(document.getElementById("address").value!=a||document.getElementById("suburb").value!=s){I=a+" "+s,B=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:I,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return b=e.data.results[0].geometry.location.lat,E=e.data.results[0].geometry.location.lng,B.push(b),B.push(E),B}).then(()=>{var e={Google_Business_Link:m,Website_Link:c,Location:(new Backendless.Data.Point).setLatitude(B[0]).setLongitude(B[1]),objectId:t,Name:n,Address:a,Suburb:s,Postcode:d,Country:i,Establishment_Type:l,Cuisine_Type:o};return Backendless.Data.of("Establishment").save(e).then(function(e){}).catch(function(e){console.log("an error has occurred "+e.message)})}).then(()=>onPageLoadTable($("#tbl").scrollTop())).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{document.getElementById("name").value=document.getElementById("update_name").value,document.getElementById("address").value=document.getElementById("update_address").value,document.getElementById("suburb").value=document.getElementById("update_suburb").value,document.getElementById("country").value=document.getElementById("update_country").value,document.getElementById("establishmentType").value=document.getElementById("update_establishment_type").value,document.getElementById("cusineType").value=document.getElementById("update_cusine_type").value}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e))})}else{if(""==document.getElementById("updateFiles").value&&(1!=u||"default.jpg"==document.getElementById("update-image-file-name").innerHTML)){if(document.getElementById("name").value!=document.getElementById("update_name").value||document.getElementById("postcode").value!=document.getElementById("update_postcode").value||document.getElementById("country").value!=document.getElementById("update_country").value||document.getElementById("establishmentType").value!=document.getElementById("update_establishment_type").value||document.getElementById("cusineType").value!=document.getElementById("update_cusine_type").value||document.getElementById("googleLink").value!=document.getElementById("update_google_link").value||document.getElementById("websiteLink").value!=document.getElementById("update_website_link").value){h={Google_Business_Link:m,Website_Link:c,objectId:t,Name:n,Address:a,Suburb:s,Postcode:d,Country:i,Establishment_Type:l,Cuisine_Type:o};return Backendless.Data.of("Establishment").save(h).then(function(e){}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>onPageLoadTable($("#tbl").scrollTop())).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).catch(e=>{console.error(e)})}return endAnimations(),document.querySelector("#updatespecial-form").reset(),void enableUpdateCustomImage()}if(1==u){var h={Google_Business_Link:m,Website_Link:c,Image:y="https://backendlessappcontent.com/073669A8-CCB7-2AED-FFEC-841A4CE5F400/CCB6BFB7-82E5-4240-A911-5E169AEA70F2/files/images/default.jpg",objectId:t,Name:n,Address:a,Suburb:s,Postcode:d,Country:i,Establishment_Type:l,Cuisine_Type:o};return cellID=t,Backendless.Data.of("Establishment").save(h).then(function(e){}).then(()=>onPageLoadTable($("#tbl").scrollTop())).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{var e=document.getElementById("update-image-file-name").innerHTML;if("default.jpg"!=e&&e!=document.getElementById("updateFilesText").value)return Backendless.Files.remove("images/"+e).then(function(){}).catch(function(e){})}).then(()=>{document.querySelector("#updatespecial-form").reset()}).then(()=>{enableUpdateCustomImage()}).then(()=>{hideCroppedImg("update")}).catch(e=>{console.error(e)})}if(0==document.getElementById("updateOnOffSwitch").checked)return console.log("Off"),file=document.getElementById("updateFiles").files[0],Backendless.Files.upload(file,"images",!0).then(function(e){y=e.fileURL}).then(()=>{var e={Google_Business_Link:m,Website_Link:c,Image:y,objectId:t,Name:n,Address:a,Suburb:s,Postcode:d,Country:i,Establishment_Type:l,Cuisine_Type:o};return cellID=t,Backendless.Data.of("Establishment").save(e).then(function(e){}).then(()=>onPageLoadTable($("#tbl").scrollTop())).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{hideCroppedImg("update")}).then(()=>{var e=document.getElementById("update-image-file-name").innerHTML;if("default.jpg"!=e&&e!=document.getElementById("updateFilesText").value)return console.log("Delete"),Backendless.Files.remove("images/"+e).then(function(){}).catch(function(e){console.log("error - "+e.message)})}).then(()=>{document.querySelector("#updatespecial-form").reset()}).catch(e=>{console.error(e)})});if(1==document.getElementById("updateOnOffSwitch").checked){console.log("On"),console.log("1. else Produce cropped image");var p=document.getElementById("updateFilesText").value;return new Promise(function(e,t){updateCropper.getCroppedCanvas({width:545,height:120,minWidth:545,minHeight:120,maxWidth:4096,maxHeight:4096,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}).toBlob(function(t){return console.log("2. convert to blob"),Backendless.Files.saveFile("images",p,t,!0).then(function(t){e(y=t),console.log("3. file has been saved - "+t)})},"image/jpeg")}).then(()=>{var e={Google_Business_Link:m,Website_Link:c,Image:y,objectId:t,Name:n,Address:a,Suburb:s,Postcode:d,Country:i,Establishment_Type:l,Cuisine_Type:o};return cellID=t,Backendless.Data.of("Establishment").save(e).then(function(e){}).then(()=>onPageLoadTable($("#tbl").scrollTop())).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{hideCroppedImg("update")}).then(()=>{var e=document.getElementById("update-image-file-name").innerHTML;if("default.jpg"!=e&&e!=document.getElementById("updateFilesText").value)return console.log("Delete"),Backendless.Files.remove("images/"+e).then(function(){}).catch(function(e){console.log("error - "+e.message)})}).then(()=>{document.querySelector("#updatespecial-form").reset()}).catch(e=>{console.error(e)})})}}else{var y;console.log("Address and file changed");var b,E,I=a+" "+s,B=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:I,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return b=e.data.results[0].geometry.location.lat,E=e.data.results[0].geometry.location.lng,B.push(b),B.push(E),B}).then(()=>{if(1!=u){if(0==document.getElementById("updateOnOffSwitch").checked)return console.log("Off"),file=document.getElementById("updateFiles").files[0],Backendless.Files.upload(file,"images",!0).then(function(e){y=e.fileURL});console.log("On"),console.log("1. else Produce cropped image");var e=document.getElementById("updateFilesText").value;return new Promise(function(t,n){updateCropper.getCroppedCanvas({width:545,height:120,minWidth:545,minHeight:120,maxWidth:4096,maxHeight:4096,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}).toBlob(function(n){return console.log("2. convert to blob"),Backendless.Files.saveFile("images",e,n,!0).then(function(e){t(y=e),console.log("3. file has been saved - "+e)})},"image/jpeg")})}y="https://backendlessappcontent.com/073669A8-CCB7-2AED-FFEC-841A4CE5F400/CCB6BFB7-82E5-4240-A911-5E169AEA70F2/files/images/default.jpg"}).then(()=>{var e={Google_Business_Link:m,Website_Link:c,Image:y,Location:(new Backendless.Data.Point).setLatitude(B[0]).setLongitude(B[1]),objectId:t,Name:n,Address:a,Suburb:s,Postcode:d,Country:i,Establishment_Type:l,Cuisine_Type:o};return console.log("4. establishment making"),Backendless.Data.of("Establishment").save(e).then(function(e){}).catch(function(e){})}).then(()=>onPageLoadTable($("#tbl").scrollTop())).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{document.getElementById("name").value=document.getElementById("update_name").value,document.getElementById("address").value=document.getElementById("update_address").value,document.getElementById("suburb").value=document.getElementById("update_suburb").value,document.getElementById("country").value=document.getElementById("update_country").value,document.getElementById("establishmentType").value=document.getElementById("update_establishment_type").value,document.getElementById("cusineType").value=document.getElementById("update_cusine_type").value}).then(()=>{var e=document.getElementById("update-image-file-name").innerHTML;if("default.jpg"!=e&&e!=document.getElementById("updateFilesText").value)return console.log("Delete"),Backendless.Files.remove("images/"+e).then(function(){}).catch(function(e){console.log("error - "+e.message)})}).then(()=>{document.querySelector("#updatespecial-form").reset()}).then(()=>{enableUpdateCustomImage()}).then(()=>{hideCroppedImg("update")}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e))})}}else if("Special details"==document.getElementById("formHeading").innerHTML){var f=document.getElementById("specialId").value,v=$("#update_days_of_the_week").val().join(", "),k=document.getElementById("update_start_time").value,_=document.getElementById("update_end_time").value,T=document.getElementById("update_category").value,S=document.getElementById("update_type_of_special").value,C=document.getElementById("update_description").value;if(!(""==v||""==k||""==_||k>_||k==_||""==T||""==S||""==C||C.length>500)){$("#updateModal").modal("close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block";var A={objectId:f,Days_Of_Week:v,Start_Time:k,End_Time:_,Category:T,Type_Of_Special:S,Description:C};return Backendless.Data.of("Special").save(A).then(function(e){}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>onPageLoadTable()).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{document.getElementById("startTime").value=tConvert(document.getElementById("update_start_time").value),document.getElementById("endTime").value=tConvert(document.getElementById("update_end_time").value),document.getElementById("category").value=document.getElementById("update_category").value,document.getElementById("typeOfSpecial").value=document.getElementById("update_type_of_special").value,document.getElementById("description").value=document.getElementById("update_description").value}).catch(e=>{console.error(e)})}g="";""==v&&(g+='"Days of the week" is required!<br>'),""==k&&(g+='"Start time" is required!<br>'),""==_&&(g+='"End time" is required!<br>'),k>_&&(g+='"Start time" cannot be later than End time!<br>'),k==_&&(g+='"Start time" cannot be the same as "End time"!<br>'),""==T&&(g+='"Category" is required!<br>'),""==S&&(g+='"Type of special" is required!<br>'),""==C&&(g+='"Description" is required!<br>'),C.length>500&&(g+='"Description" must be less than 500 characters!<br>'),toastNotification(g,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}}),updateCancelBtn.addEventListener("click",e=>{if(e.preventDefault(),M.Toast.dismissAll(),"Establishment details"==document.getElementById("formHeading").innerHTML){var t=document.getElementById("name").value,n=document.getElementById("address").value,a=document.getElementById("suburb").value,s=document.getElementById("postcode").value,d=document.getElementById("country").value,i=document.getElementById("establishmentType").value,l=document.getElementById("cusineType").value,o=document.getElementById("googleLink").value,m=document.getElementById("websiteLink").value,c=document.getElementById("update_name").value,r=document.getElementById("update_address").value,u=document.getElementById("update_suburb").value,g=document.getElementById("update_postcode").value,h=document.getElementById("update_country").value,p=document.getElementById("update_establishment_type").value,y=$("#update_cusine_type").val().join(", "),b=document.getElementById("update_google_link").value,E=document.getElementById("update_website_link").value,I=document.getElementById("updateFilesText").value,B=document.getElementById("chkBoxUpdateDefaultImg").checked;t==c&&n==r&&a==u&&s==g&&d==h&&i==p&&l==y&&o==b&&m==E&&""==I&&0==B?$("#updateModal").modal("close"):$("#unsavedModal").modal("open"),enableUpdateCustomImage()}else{var f=document.getElementById("daysOfWeek").value,v=document.getElementById("startTime").value,k=document.getElementById("endTime").value,_=document.getElementById("category").value,T=document.getElementById("typeOfSpecial").value,S=document.getElementById("description").value,C=$("#update_days_of_the_week").val().join(", "),A=tConvert(document.getElementById("update_start_time").value),w=tConvert(document.getElementById("update_end_time").value),L=document.getElementById("update_category").value,x=document.getElementById("update_type_of_special").value,D=document.getElementById("update_description").value;f==C&&v==A&&k==w&&_==L&&T==x&&S==D?$("#updateModal").modal("close"):$("#unsavedModal").modal("open")}}),unsavedDiscardBtn.addEventListener("click",e=>{$("#updateModal").modal("close"),updateForm=document.querySelector("#updatespecial-form"),updateForm.reset(),hideCroppedImg("update")}),visibilityBtn.addEventListener("click",e=>{var t;console.log("hello"),e.preventDefault(),M.Toast.dismissAll();for(var n=0;n<masterEstablishments.length;n++)masterEstablishments[n].objectId==cellID&&(t=masterEstablishments[n]);if(""==document.getElementById("establishmentId").value)toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else if("Establishment details"==document.getElementById("formHeading").innerHTML)$("#visibilityModal").modal("open"),document.getElementById("visibilityHeading").innerHTML="Change Establishment Visibility",1==t.Visible?(document.getElementById("modalVisibilityTitle").innerHTML="Do you want to hide the selected establishment?",document.getElementById("modalVisibilityMessage").innerHTML="It will be marked as hidden and will no longer display in customer search queries"):(document.getElementById("modalVisibilityTitle").innerHTML="Do you want to re-enable the selected establishment?",document.getElementById("modalVisibilityMessage").innerHTML="It will be redisplayed in customer search queries"),document.getElementById("modalVisibilityEntity").innerHTML="<b>"+document.getElementById("name").value+"</b>";else if("Special details"==document.getElementById("formHeading").innerHTML)if(""==document.getElementById("specialId").value)toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{for(var a=0,s=t.establishmentSpecials.length;a<s;a++)if(t.establishmentSpecials[a].objectId==document.getElementById("specialId").value){var d=t.establishmentSpecials[a].Visible;console.log(d);break}$("#visibilityModal").modal("open"),document.getElementById("visibilityHeading").innerHTML="Change Special Visibility",1==d?(document.getElementById("modalVisibilityTitle").innerHTML="Do you want to hide <b>"+document.getElementById("name").value+"'s </b>"+document.getElementById("category").value+"?<br>",document.getElementById("modalVisibilityEntity").innerHTML='"'+document.getElementById("description").value+'"',document.getElementById("modalVisibilityMessage").innerHTML="It will be marked as hidden and will no longer display in customer search queries"):(document.getElementById("modalVisibilityTitle").innerHTML="Do you want to re-enable <b>"+document.getElementById("name").value+"'s </b>"+document.getElementById("category").value+"?<br>",document.getElementById("modalVisibilityEntity").innerHTML='"'+document.getElementById("description").value+'"',document.getElementById("modalVisibilityMessage").innerHTML="It will be redisplayed in customer search queries")}}),visibilityConfirmBtn.addEventListener("click",e=>{var t,n;console.log("fg"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block";for(var a=0,s=masterEstablishments.length;a<s;a++)if(masterEstablishments[a].objectId==document.getElementById("establishmentId").value){if(console.log(masterEstablishments[a]),"Establishment details"==document.getElementById("formHeading").innerHTML){t=1==masterEstablishments[a].Visible?{objectId:masterEstablishments[a].objectId,Visible:!1}:{objectId:masterEstablishments[a].objectId,Visible:!0},console.log("1. created visable establishment");break}console.log("Special object created");for(var d=0,i=masterEstablishments[a].establishmentSpecials.length;d<i;d++)if(masterEstablishments[a].establishmentSpecials[d].objectId==document.getElementById("specialId").value){n=1==masterEstablishments[a].establishmentSpecials[d].Visible?{objectId:document.getElementById("specialId").value,Visible:!1}:{objectId:document.getElementById("specialId").value,Visible:!0};break}}return"Establishment details"==document.getElementById("formHeading").innerHTML?(console.log("2. Updating visable establishment"),Backendless.Data.of("Establishment").save(t).then(()=>{console.log("3. Finished Updating visable establishment")}).then(()=>onPageLoadTable()).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).catch(function(e){toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()})):(console.log("2. Updating visable special"),Backendless.Data.of("Special").save(n).then(()=>{console.log("3. Finished Updating visable special")}).then(()=>onPageLoadTable()).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).catch(function(e){toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()}))}),deleteBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll(),""==document.getElementById("establishmentId").value?toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0):"Establishment details"==document.getElementById("formHeading").innerHTML?($("#modalDeleteCancelConfirm").modal("open"),document.getElementById("deleteConfirmHeading").innerHTML="Delete establishment",document.getElementById("establishmentToDelete").innerHTML="Do you want to delete the selected Establishment?<br><br><b>"+document.getElementById("name").value+"</b>"):"Special details"==document.getElementById("formHeading").innerHTML&&(""==document.getElementById("specialId").value?toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0):($("#modalDeleteCancelConfirm").modal("open"),document.getElementById("establishmentToDelete").innerHTML="Do you want to delete <b>"+document.getElementById("name").value+"'s </b>"+document.getElementById("category").value+'?<br><br>"'+document.getElementById("description").value+'"',document.getElementById("deleteConfirmHeading").innerHTML="Delete Special"))}),deleteCancelConfirmDeleteBtn.addEventListener("click",e=>{if(e.preventDefault(),"Establishment details"==document.getElementById("formHeading").innerHTML){for(var t=document.getElementById("establishmentId").value,n=0;n<masterEstablishments.length;n++)if(masterEstablishments[n].objectId==t){if(!(masterEstablishments[n].establishmentSpecials.length>0)){document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Deleting",document.getElementById("h5workingAnimMessage").style.display="block";var a=/[^\/]*$/.exec(masterEstablishments[n].Image)[0];return"default.jpg"!=a&&Backendless.Files.remove("images/"+a).then(function(){}).catch(function(e){console.log("error - "+e.message)}),Backendless.Data.of("Establishment").remove({objectId:t}).then(function(e){}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>{onPageLoadTable()}).then(()=>{document.getElementById("image").src="/images/default.jpg",$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("addToExistingEstablishment").value="",document.getElementById("image-file-name").innerHTML=""}).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).catch(e=>{console.error(e)})}toastNotification("The establishment must contain no specials in order to delete.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}}else if("Special details"==document.getElementById("formHeading").innerHTML){var s=document.getElementById("specialId").value;return Backendless.Data.of("Special").remove({objectId:s}).then(function(e){}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>{$("#specialListBox option:selected").remove(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset()}).then(()=>{onPageLoadTable()}).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).catch(e=>{console.error(e)})}}),jQuery(".white-text").click(function(e){jQuery(".selected-sidenav").removeClass("selected-sidenav"),jQuery(this).addClass("selected-sidenav")});const image=document.getElementById("image-cropper");var cropper=new Cropper(image,{viewMode:1,minCropBoxWidth:545,minCropBoxHeight:120}),loadFile=function(e){null==e.target.files[0]?hideCroppedImg("create"):(document.getElementById("imgCropperContainer").style.display="block",document.getElementById("imageCropperError").style.display="block"),cropper.replace(URL.createObjectURL(e.target.files[0]));var t=new Image;t.onload=function(){document.getElementById("imgSwitch").style.display="block";var e="";120==this.height&&545==this.width?e+='Image dimensions are perfect! (W:545 x H:120) <img class="check-dimensions-img" src="../images/ok-dimensions.png">':120==this.height?e+='Image height is perfect! (H:120) <img class="check-dimensions-img" src="../images/ok-dimensions.png"><br>':545==this.width&&(e+='Image width is perfect! (W:545) <img class="check-dimensions-img" src="../images/ok-dimensions.png"><br>'),this.height>120&&(e+="Image height too large ("+this.height+' pixels) - Please crop image to defined sizing (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),this.height<120&&(e+="Image height too small ("+this.height+' pixels) - Please increase orignal size to avoid distortions (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),this.width>545&&(e+="Image width too large ("+this.width+' pixels) -  Please crop image to defined sizing (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),this.width<545&&(e+="Image width too small ("+this.width+' pixels) - Please increase orignal size to avoid distortions (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),document.getElementById("imageCropperError").innerHTML="<br>"+e+"<br><br>"},t.src=URL.createObjectURL(e.target.files[0])};const updateImage=document.getElementById("update-image-cropper");var updateCropper=new Cropper(updateImage,{viewMode:1,minCropBoxWidth:545,minCropBoxHeight:120}),updateLoadFile=function(e){null==e.target.files[0]?hideCroppedImg():(document.getElementById("updateImgCropperContainer").style.display="block",document.getElementById("updateImageCropperError").style.display="block"),updateCropper.replace(URL.createObjectURL(e.target.files[0]));var t=new Image;t.onload=function(){document.getElementById("updateImgSwitch").style.display="block";var e="";120==this.height&&545==this.width?e+='Image dimensions are perfect! (W:545 x H:120) <img class="check-dimensions-img" src="../images/ok-dimensions.png">':120==this.height?e+='Image height is perfect! (H:120) <img class="check-dimensions-img" src="../images/ok-dimensions.png"><br>':545==this.width&&(e+='Image width is perfect! (W:545) <img class="check-dimensions-img" src="../images/ok-dimensions.png"><br>'),this.height>120&&(e+="Image height too large ("+this.height+' pixels) - Please crop image to defined sizing (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),this.height<120&&(e+="Image height too small ("+this.height+' pixels) - Please increase orignal size to avoid distortions (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),this.width>545&&(e+="Image width too large ("+this.width+' pixels) -  Please crop image to defined sizing (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),this.width<545&&(e+="Image width too small ("+this.width+' pixels) - Please increase orignal size to avoid distortions (W:545 x H:120) <img class="check-dimensions-img" src="../images/wrong-dimensions.png"><br>'),document.getElementById("updateImageCropperError").innerHTML="<br>"+e+"<br><br>"},t.src=URL.createObjectURL(e.target.files[0])};function hideCroppedImg(e){"create"==e?(document.getElementById("imgCropperContainer").style.display="none",document.getElementById("imageCropperError").style.display="none",document.getElementById("imgSwitch").style.display="none"):(document.getElementById("updateImgCropperContainer").style.display="none",document.getElementById("updateImageCropperError").style.display="none",document.getElementById("updateImgSwitch").style.display="none")}exportConfirmBtn.addEventListener("click",e=>{var t=document.getElementById("establishmentExportChkBox").checked,n=document.getElementById("specialExportChkBox").checked,a=document.getElementById("cuisineExportChkBox").checked,s=document.getElementById("adminExportChkBox").checked;if(0==t&&0==n&&0==a&&0==s)M.Toast.dismissAll(),toastNotification("Please select a table","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{if(1==t){const e=100,t=async()=>{let t=0,n=[];const a=Backendless.DataQueryBuilder.create();a.setRelated(["establishmentSpecials"]),a.setSortBy(["Country","Name"]),a.setPageSize(e);do{const e=await Backendless.Data.of("Establishment").find(a);t=e.length,n=n.concat(e),a.prepareNextPage()}while(t>=e);return n},n=e=>{var t=[],n=[];n.push("Country","Location","Address","Suburb","Postcode","Establishment_ Type","Cuisine_Type","Name","Image","Google_Business_Link","Website_Link","objectId"),t.push(n),e.forEach(e=>{tempEstablishment=[],tempEstablishment.push(e.Country);var n="POINT("+e.Location.x+" "+e.Location.y+")";tempEstablishment.push(n),tempEstablishment.push(e.Address),tempEstablishment.push(e.Suburb),tempEstablishment.push(e.Postcode),tempEstablishment.push(e.Establishment_Type),tempEstablishment.push(e.Cuisine_Type),tempEstablishment.push(e.Name),tempEstablishment.push(e.Image),tempEstablishment.push(e.Google_Business_Link),tempEstablishment.push(e.Website_Link),tempEstablishment.push(e.objectId),t.push(tempEstablishment)});let a="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var s=encodeURI(a),d=document.createElement("a");d.setAttribute("href",s),d.setAttribute("download","Establishment.csv"),document.body.appendChild(d),d.click()},a=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(n).catch(a)}if(1==n){const e=100,t=async()=>{let t=0,n=[];const a=Backendless.DataQueryBuilder.create();a.setRelated(["establishmentSpecials"]),a.setSortBy(["Country","Name"]),a.setPageSize(e);do{const e=await Backendless.Data.of("Establishment").find(a);t=e.length,n=n.concat(e),a.prepareNextPage()}while(t>=e);return n},n=e=>{var t=[],n=[];n.push("Type_Of_Special","Days_Of_Week","Start_Time","End_Time","Category","Description","objectId"),t.push(n),e.forEach(e=>{for(var n=0,a=e.establishmentSpecials.length;n<a;n++)tempSpecial=[],tempSpecial.push(e.establishmentSpecials[n].Type_Of_Special),tempSpecial.push(`"${e.establishmentSpecials[n].Days_Of_Week}"`),tempSpecial.push(e.establishmentSpecials[n].Start_Time),tempSpecial.push(e.establishmentSpecials[n].End_Time),tempSpecial.push(e.establishmentSpecials[n].Category),tempSpecial.push(e.establishmentSpecials[n].Description),tempSpecial.push(e.establishmentSpecials[n].objectId),t.push(tempSpecial)});let a="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var s=encodeURI(a),d=document.createElement("a");d.setAttribute("href",s),d.setAttribute("download","Special.csv"),document.body.appendChild(d),d.click()},a=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(n).catch(a)}if(1==a){const e=100,t=async()=>{let t=0,n=[];const a=Backendless.DataQueryBuilder.create();a.setSortBy(["Name"]),a.setPageSize(e);do{const e=await Backendless.Data.of("Cuisine").find(a);t=e.length,n=n.concat(e),a.prepareNextPage()}while(t>=e);return n},n=e=>{var t=[],n=[];n.push("Name"),t.push(n),e.forEach(e=>{tempCuisine=[],tempCuisine.push(e.Name),t.push(tempCuisine)});let a="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var s=encodeURI(a),d=document.createElement("a");d.setAttribute("href",s),d.setAttribute("download","Cuisine.csv"),document.body.appendChild(d),d.click()},a=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(n).catch(a)}if(1==s){const e=100,t=async()=>{let t=0,n=[];const a=Backendless.DataQueryBuilder.create();a.setSortBy(["name"]),a.setPageSize(e);do{const e=await Backendless.Data.of("Users").find(a);t=e.length,n=n.concat(e),a.prepareNextPage()}while(t>=e);return n},n=e=>{var t=[],n=[];n.push("Username"),n.push("Email"),t.push(n),e.forEach(e=>{tempAdmin=[],tempAdmin.push(e.name),tempAdmin.push(e.email),t.push(tempAdmin)});let a="data:text/csv;charset=utf-8,"+t.map(e=>e.join(",")).join("\n");var s=encodeURI(a),d=document.createElement("a");d.setAttribute("href",s),d.setAttribute("download","Admin.csv"),document.body.appendChild(d),d.click()},a=e=>{toastNotification(e.code+" "+e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)};Promise.resolve().then(t).then(n).catch(a)}}});